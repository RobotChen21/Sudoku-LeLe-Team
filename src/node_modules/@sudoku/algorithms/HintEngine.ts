// src/node_modules/@sudoku/algorithms/HintEngine.ts

import { NakedSingleStrategy } from './strategies/NakedSingleStrategy';
import { HiddenSingleStrategy } from './strategies/HiddenSingleStrategy';
// @ts-ignore: missing type declarations for '../sudoku'
import { solveSudoku } from '../sudoku';
import type { Grid, HintResult } from './types';

const strategies = [
  new NakedSingleStrategy(),
  new HiddenSingleStrategy()
];

export function getHint(grid: Grid): HintResult | null {
  // 1. 按顺序尝试所有策略
  for (const strategy of strategies) {
    const hint = strategy.findHint(grid);
    if (hint) return hint;
  }

  // 2. 兜底：调用完整求解器
  const solved = solveSudoku(grid);
  if (!solved) return null; // 无解
  
  // 找第一个用户未填但已解的位置
  for (let y = 0; y < 9; y++) {
    for (let x = 0; x < 9; x++) {
      if (grid[y][x] === 0 && solved[y][x] !== 0) {
        return {
          hintType: '完整求解器（兜底）',
          targetCell: [x, y],
          value: solved[y][x],
          relatedCells: [],
          reason: '当前盘面需要高级策略，系统将提供一个可行解。'
        };
      }
    }
  }

  return null; // 已完成
}